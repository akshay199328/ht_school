!function(t){var e={};function s(a){if(e[a])return e[a].exports;var r=e[a]={i:a,l:!1,exports:{}};return t[a].call(r.exports,r,r.exports,s),r.l=!0,r.exports}s.m=t,s.c=e,s.d=function(t,e,a){s.o(t,e)||Object.defineProperty(t,e,{enumerable:!0,get:a})},s.r=function(t){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:!0})},s.t=function(t,e){if(1&e&&(t=s(t)),8&e)return t;if(4&e&&"object"==typeof t&&t&&t.__esModule)return t;var a=Object.create(null);if(s.r(a),Object.defineProperty(a,"default",{enumerable:!0,value:t}),2&e&&"string"!=typeof t)for(var r in t)s.d(a,r,function(e){return t[e]}.bind(null,r));return a},s.n=function(t){var e=t&&t.__esModule?function(){return t.default}:function(){return t};return s.d(e,"a",e),e},s.o=function(t,e){return Object.prototype.hasOwnProperty.call(t,e)},s.p="",s(s.s=0)}([function(t,e,s){"use strict";s.r(e);s(1);const{createElement:a,render:r,useState:n,useEffect:i,Fragment:o}=wp.element,{select:l,dispatch:c}=wp.data,u=t=>{const[e,s]=n(!0),[r,c]=n([]),[u,d]=n(0),[m,p]=n(0),[g,v]=n({}),[h,w]=n({}),[b,_]=n(0),[f,y]=n(!1);i(()=>{if(!document.getElementById("chartjs")){const t=document.createElement("script");t.src=window.wplms_course_data.chartjs,t.id="chartjs",document.body.appendChild(t),t.onload=()=>{y(!0)}}},[]),i(()=>{fetch(`${window.instructorsimplestats.api}/instructor_stats/`,{method:"post",body:JSON.stringify({number:t.settings.max,token:l("vibebp").getToken(),user_id:window.instructor_stats.user_id})}).then(t=>t.json()).then(t=>{t.status&&c(t.data),s(!1)})},[]),i(()=>{r&&r.length&&!e&&f&&N(r)},[r,e,f]);const N=t=>{if(t&&t.length){let e={labels:[]},s=[],a=[];t.map(t=>{t.hasOwnProperty("average")&&""!=t.average&&null!=t.average&&(t.average=parseInt(t.average),a.push(t.average),e.labels.push(t.title),s.push(k()))}),e.datasets=[{label:window.instructor_stats.translations.average,data:a,backgroundColor:s,borderWidth:1}],v(e)}else v({})},k=()=>{for(var t="#",e=0;e<6;e++)t+="0123456789ABCDEF"[Math.floor(16*Math.random())];return t};i(()=>{if(g&&Object.keys(g).length){Object.keys(g).map(t=>{}),h&&Object.keys(h)&&Object.keys(h).length&&h.destroy();let t=document.getElementById("instructor-graph-stats"),e=new Chart(t,{type:"bar",data:{labels:g.labels,datasets:g.datasets},options:{responsive:!0,scales:{xAxes:[{ticks:{beginAtZero:!0}}],yAxes:[{ticks:{beginAtZero:!0}}]}}});w(e)}},[g]);const O=e=>{if(e.id){let a={};fetch(`${window.instructorsimplestats.api}/generate_ranges/`,{method:"post",body:JSON.stringify({range:t.settings.range,token:l("vibebp").getToken(),user_id:window.instructor_stats.user_id,unit:e.id})}).then(t=>t.json()).then(t=>{if(t.status){if(a.labels=[],a.datasets=[],t.hasOwnProperty("data")&&t.data.length){let e={label:window.instructor_stats.translations.students,backgroundColor:[],data:[],borderWidth:1};t.data.map(t=>{a.labels.push(t.range),e.data.push(t.value),e.backgroundColor.push(k())}),a.datasets=[e],v(a)}}else v({});s(!1)})}else v({})};return a("div",{className:"instructor_stats_wrapper widget",style:{width:"100%"}},a("h3",{className:"widget_title"},t.settings.title),e?a("div",{class:"widget_loader"},a("div",null),a("div",null),a("div",null),a("div",null)):a("div",{className:"instructor_stats"},r&&r.length?a(o,null,a("div",{className:"course-list"},r.map((t,e)=>a("div",{className:"course-item-wrapper"},a("div",{className:"course-item "+(e===u?"active":"")},a("span",{onClick:()=>{d(e),_(0)}},t.title),a("div",{className:"actions"},a("div",{className:"tip",title:window.instructor_stats.translations.show_stats_graph,onClick:()=>{O(t)}},a("i",{className:"vicon vicon-bar-chart"})),a("div",{className:"tip",title:window.instructor_stats.translations.reload_stats,onClick:()=>{((t,e)=>{t.id&&fetch(`${window.instructorsimplestats.api}/recalculate_stats/`,{method:"post",body:JSON.stringify({course:t.id,token:l("vibebp").getToken(),user_id:window.instructor_stats.user_id})}).then(t=>t.json()).then(t=>{if(t.status){let s=[...r];s[e].average=t.average,c(s)}})})(t,e)}},a("i",{className:"vicon vicon-reload"})),a("div",{className:"tip",title:window.instructor_stats.translations.load_curriculum,onClick:()=>{((t,e)=>{t.id&&fetch(`${window.instructorsimplestats.api}/load_quiz_assignment/`,{method:"post",body:JSON.stringify({course:t.id,token:l("vibebp").getToken(),user_id:window.instructor_stats.user_id})}).then(t=>t.json()).then(t=>{let s=[...r];t.status&&t.hasOwnProperty("curriculum")&&t.curriculum.length?s[e].curriculum=t.curriculum:s[e].curriculum=[],c(s)})})(t,e)}},a("i",{className:"vicon vicon-plus"})))),t.hasOwnProperty("curriculum")?t.curriculum.length?a("div",{className:"course_curriculum"},t.curriculum.map((t,e)=>a("div",{className:"course-item "+(e===b?"active":""),onClick:()=>{O(t),_(e)}},a("h5",null,t.title),a("div",{className:"actions"},a("div",{className:""},a("i",{className:"icon-bars"})))))):a("div",{className:"message"},a("p",null,window.instructor_stats.translations.no_data)):""))),a("div",{className:"graph-area"},g&&Object.keys(g).length?a("canvas",{id:"instructor-graph-stats",ref:t=>{t&&!m&&p(t)}}):a("div",{className:"message"},window.instructor_commissions.translations.no_data))):a("div",{className:"vbp_message"},window.instructor_stats.translations.no_data)))};document.addEventListener("wplms_instructor_stats",t=>{document.querySelector(".instructor_stats")&&r(a(u,{settings:t.detail.widget.options}),document.querySelector(".instructor_stats"))})},function(t,e,s){}]);