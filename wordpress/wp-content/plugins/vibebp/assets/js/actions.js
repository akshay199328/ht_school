!function(e){var t={};function n(r){if(t[r])return t[r].exports;var i=t[r]={i:r,l:!1,exports:{}};return e[r].call(i.exports,i,i.exports,n),i.l=!0,i.exports}n.m=e,n.c=t,n.d=function(e,t,r){n.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:r})},n.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},n.t=function(e,t){if(1&t&&(e=n(e)),8&t)return e;if(4&t&&"object"==typeof e&&e&&e.__esModule)return e;var r=Object.create(null);if(n.r(r),Object.defineProperty(r,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var i in e)n.d(r,i,function(t){return e[t]}.bind(null,i));return r},n.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return n.d(t,"a",t),t},n.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},n.p="",n(n.s=0)}([function(e,t,n){"use strict";function r(e,t){return function(e){if(Array.isArray(e))return e}(e)||function(e,t){if(!(Symbol.iterator in Object(e)||"[object Arguments]"===Object.prototype.toString.call(e)))return;var n=[],r=!0,i=!1,a=void 0;try{for(var o,s=e[Symbol.iterator]();!(r=(o=s.next()).done)&&(n.push(o.value),!t||n.length!==t);r=!0);}catch(e){i=!0,a=e}finally{try{r||null==s.return||s.return()}finally{if(i)throw a}}return n}(e,t)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance")}()}n.r(t);var i=wp.element,a=(i.createElement,i.useState),o=(i.useEffect,i.Fragment),s=(i.render,wp.data),l=(s.dispatch,s.select),u=function(e){var t=r(a(!1),2),n=t[0],i=(t[1],r(a(!1),2)),s=i[0],u=i[1],c=r(a(""),2),d=c[0],f=c[1],m=r(a(!1),2),p=m[0],b=m[1];return wp.element.createElement(o,null,s?wp.element.createElement("div",{className:"messagebox"},wp.element.createElement("textarea",{value:d,placeholder:window.vibebpactions.translations.message_text,onChange:function(e){return f(e.target.value)}}),wp.element.createElement("div",null,wp.element.createElement("a",{className:p?"button is-primary is-loading":"button is-primary",onClick:function(){b(!0);var t=new FormData;t.append("body",JSON.stringify({args:{content:d,recipients:[e.user_id],subject:window.vibebpactions.translations.message_subject,thread_id:0,meta:[]},token:e.token})),fetch("".concat(window.vibebpactions.api_url,"/messages/send"),{method:"post",body:t}).then((function(e){return e.json()})).then((function(e){b(!1),u(!1)}))},dangerouslySetInnerHTML:{__html:e.alt}}),wp.element.createElement("a",{className:"link",onClick:function(){return u(!1)}},window.vibebpactions.translations.cancel))):l("vibebp").getUser().id!=e.user_id?wp.element.createElement("span",{className:n?"button is-primary is-loading":"button is-primary",dangerouslySetInnerHTML:{__html:e.def},onClick:function(){return u(!0)}}):"")};function c(e,t){return function(e){if(Array.isArray(e))return e}(e)||function(e,t){if(!(Symbol.iterator in Object(e)||"[object Arguments]"===Object.prototype.toString.call(e)))return;var n=[],r=!0,i=!1,a=void 0;try{for(var o,s=e[Symbol.iterator]();!(r=(o=s.next()).done)&&(n.push(o.value),!t||n.length!==t);r=!0);}catch(e){i=!0,a=e}finally{try{r||null==s.return||s.return()}finally{if(i)throw a}}return n}(e,t)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance")}()}var d=wp.element,f=(d.createElement,d.useState),m=d.useEffect,p=d.Fragment,b=(d.render,wp.data),y=b.dispatch,v=b.select,w=function(e){var t=c(f(!1),2),n=t[0],r=t[1],i=c(f(!1),2),a=i[0],o=i[1];m((function(){var t=v("vibebp").getData("friends");void 0!==t||Array.isArray(t)?Array.isArray(t)&&t.indexOf(e.user_id)>-1&&o(!0):fetch("".concat(window.vibebpactions.api_url,"/friend_ids"),{method:"post",body:JSON.stringify({token:e.token})}).then((function(e){return e.json()})).then((function(n){n.status&&(t=n.friends,y("vibebp").setData("friends",n.friends),t.indexOf(e.user_id)>-1&&o(!0))}))}),[]);return wp.element.createElement(p,null,a?wp.element.createElement("span",{className:n?"button is-primary is-loading":"button is-primary",onClick:function(){r(!0),fetch("".concat(window.vibebpactions.api_url,"/friends/removefriendship"),{method:"post",body:JSON.stringify({friend_userid:e.user_id,token:e.token})}).then((function(e){return e.json()})).then((function(e){r(!1),o(!1)})),setFriends(nfriends)},dangerouslySetInnerHTML:{__html:e.alt}}):v("vibebp").getUser().id!=e.user_id?wp.element.createElement("span",{className:n?"button is-primary is-loading":"button is-primary",onClick:function(){r(!0),fetch("".concat(window.vibebp.api.url,"/friends/addfriendship"),{method:"post",body:JSON.stringify({friends:[e.user_id],token:e.token})}).then((function(e){return e.json()})).then((function(e){r(!1),o(!0)}))},dangerouslySetInnerHTML:{__html:e.def}}):"")};function g(e,t){return function(e){if(Array.isArray(e))return e}(e)||function(e,t){if(!(Symbol.iterator in Object(e)||"[object Arguments]"===Object.prototype.toString.call(e)))return;var n=[],r=!0,i=!1,a=void 0;try{for(var o,s=e[Symbol.iterator]();!(r=(o=s.next()).done)&&(n.push(o.value),!t||n.length!==t);r=!0);}catch(e){i=!0,a=e}finally{try{r||null==s.return||s.return()}finally{if(i)throw a}}return n}(e,t)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance")}()}var h=wp.element,_=(h.createElement,h.useState),E=h.useEffect,S=h.Fragment,O=(h.render,wp.data),j=O.dispatch,k=O.select,A=function(e){var t=g(_(!1),2),n=t[0],r=t[1],i=g(_(!1),2),a=i[0],o=i[1];E((function(){var t=k("vibebp").getData("followers");Array.isArray(t)&&t.indexOf(e.user_id)>-1&&o(!0)}),[]);var s=function(t){r(!0),fetch("".concat(window.vibebpactions.api_url,"/followers/action"),{method:"post",body:JSON.stringify({action:t,user:e.user_id,token:e.token})}).then((function(e){return e.json()})).then((function(n){if(r(!1),n.status){if("follow"===t){var i=k("vibebp").getData("followers");i.push(e.user_id),j("vibebp").setData("followers",i),o(!0),j("vibebp").addNotification({message:n.message}),j("vibebp").sendRealTimeNotification(n.rtm.user_id,n.rtm.message)}if("unfollow"===t){var a=k("vibebp").getData("followers");a.splice(a.indexOf(e.user_id),1),j("vibebp").setData("followers",a),o(!1),j("vibebp").addNotification({message:n.message}),j("vibebp").sendRealTimeNotification(n.rtm.user_id,n.rtm.message)}}}))};return wp.element.createElement(S,null,a?wp.element.createElement("span",{className:n?"button is-primary is-loading":"button is-primary",dangerouslySetInnerHTML:{__html:e.alt},onClick:function(){return s("unfollow")}}):k("vibebp").getUser().id!=e.user_id?wp.element.createElement("span",{className:n?"button is-primary is-loading":"button is-primary",dangerouslySetInnerHTML:{__html:e.def},onClick:function(){return s("follow")}}):"")};function N(e,t){return function(e){if(Array.isArray(e))return e}(e)||function(e,t){if(!(Symbol.iterator in Object(e)||"[object Arguments]"===Object.prototype.toString.call(e)))return;var n=[],r=!0,i=!1,a=void 0;try{for(var o,s=e[Symbol.iterator]();!(r=(o=s.next()).done)&&(n.push(o.value),!t||n.length!==t);r=!0);}catch(e){i=!0,a=e}finally{try{r||null==s.return||s.return()}finally{if(i)throw a}}return n}(e,t)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance")}()}var L=wp.element,T=(L.createElement,L.useState),x=L.useEffect,M=L.Fragment,I=(L.render,wp.data),D=(I.dispatch,I.select),H=function(e){var t=N(T(!1),2),n=t[0],r=t[1];x((function(){var t=D("vibebp").getOnlineMembers();Array.isArray(t)&&t.indexOf(e.user_id)>-1&&r(!0),document.addEventListener("onlinemembers_loaded",(function(t){t.detail&&setTimeout((function(){var t=D("vibebp").getOnlineMembers();Array.isArray(t)&&t.indexOf(e.user_id)>-1&&r(!0)}),200)}))}),[]);return wp.element.createElement(M,null,D("vibebp").getUser().id!=e.user_id?n?wp.element.createElement("span",{onClick:function(){document.dispatchEvent(new CustomEvent("trigger_user_chat",{detail:{userId:e.user_id}}))},className:"button is-primary",dangerouslySetInnerHTML:{__html:e.def}}):wp.element.createElement("span",{className:"button is-primary",dangerouslySetInnerHTML:{__html:e.alt+" ("+window.vibebpactions.translations.offline+")"}}):"")},C=wp.element,F=(C.createElement,C.useState,C.useEffect),J=(C.Fragment,C.render,wp.data),q=(J.dispatch,J.select,function(e){return F((function(){})),wp.element.createElement("span",{className:"button is-primary",dangerouslySetInnerHTML:{__html:e.def}})}),P=wp.element,U=(P.createElement,P.useState,P.useEffect,P.Fragment,P.render),R=wp.data,z=R.dispatch,B=R.select;document.addEventListener("vibebp_all_members_loaded",(function(){localforage.getItem("bp_login_token").then((function(e){e?(!window.vibebpactions.followers||B("vibebp")&&B("vibebp").getData("following")||fetch("".concat(window.vibebpactions.api_url,"/following_ids"),{method:"post",body:JSON.stringify({token:e})}).then((function(e){return e.json()})).then((function(e){e.status&&z("vibebp").setData("following",e.following)})),!window.vibebpactions.friends||B("vibebp")&&B("vibebp").getData("friends")||fetch("".concat(window.vibebpactions.api_url,"/friend_ids"),{method:"post",body:JSON.stringify({token:e})}).then((function(e){return e.json()})).then((function(e){e.status&&z("vibebp").setData("friends",e.friends)})),document.querySelectorAll(".member_action").forEach((function(t){var n=t.getAttribute("data-member"),r=t.querySelector("span").innerHTML,i="";t.querySelector("span.hide")&&(i=t.querySelector("span.hide").innerHTML),t.classList.contains("send_message")&&U(wp.element.createElement(u,{user_id:n,token:e,def:r,alt:i}),t),t.classList.contains("send_message")&&U(wp.element.createElement(u,{user_id:n,token:e,def:r,alt:i}),t),t.classList.contains("friend")&&U(wp.element.createElement(w,{user_id:n,token:e,def:r,alt:i}),t),t.classList.contains("follow")&&U(wp.element.createElement(A,{user_id:n,token:e,def:r,alt:i}),t),t.classList.contains("chat")&&U(wp.element.createElement(H,{user_id:n,token:e,def:r,alt:i}),t),t.classList.contains("view_profile")&&U(wp.element.createElement(q,{user_id:n,def:r}),t)}))):document.querySelectorAll(".member_action").forEach((function(e){e.addEventListener("click",(function(){document.dispatchEvent(new Event("vibebp_show_login_popup"))}))}))}))}))}]);