!function(e){var n={};function t(s){if(n[s])return n[s].exports;var o=n[s]={i:s,l:!1,exports:{}};return e[s].call(o.exports,o,o.exports,t),o.l=!0,o.exports}t.m=e,t.c=n,t.d=function(e,n,s){t.o(e,n)||Object.defineProperty(e,n,{enumerable:!0,get:s})},t.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},t.t=function(e,n){if(1&n&&(e=t(e)),8&n)return e;if(4&n&&"object"==typeof e&&e&&e.__esModule)return e;var s=Object.create(null);if(t.r(s),Object.defineProperty(s,"default",{enumerable:!0,value:e}),2&n&&"string"!=typeof e)for(var o in e)t.d(s,o,function(n){return e[n]}.bind(null,o));return s},t.n=function(e){var n=e&&e.__esModule?function(){return e.default}:function(){return e};return t.d(n,"a",n),n},t.o=function(e,n){return Object.prototype.hasOwnProperty.call(e,n)},t.p="",t(t.s=0)}([function(e,n,t){"use strict";t.r(n);t(1);const{createElement:s,render:o,useState:i,useEffect:c,Fragment:a,useRef:l}=wp.element,{select:d,dispatch:m}=wp.data,_=e=>{React.useRef();const[n,t]=i(!0),[o,l]=i("note"),[m,_]=i([]),[u,r]=i([]),[p,v]=i([]),[f,w]=i([]),[h,b]=i({}),[g,y]=i([]),[N,k]=i({}),[O,x]=i(!0),[C,S]=i(1);c(()=>{fetch(`${window.notes_discussions.api}/get_notes/`,{method:"post",body:JSON.stringify({token:d("vibebp").getToken(),number:e.settings.number,type:"note"})}).then(e=>e.json()).then(e=>{e.status&&e.data&&r(e.data),t(!1)}),fetch(`${window.notes_discussions.api}/get_notes/`,{method:"post",body:JSON.stringify({user_id:window.notes_discussions.user_id,token:d("vibebp").getToken(),number:e.settings.number,type:"public"})}).then(e=>e.json()).then(e=>{e.status&&e.data&&v(e.data),t(!1)})},[]);const I=(e,n,t)=>{if(!(N&&N.hasOwnProperty("comment_content")&&N.comment_content.length>3))return alert(window.notes_discussions.translations.enter_some_content),!1;N.comment_ID=e.comment_ID,N.comment_post_ID=e.comment_post_ID,N.unit=e.comment_post_ID,N.user_id=window.notes_discussions.user_id,N.type="edit",fetch(`${window.notes_discussions.api}/add_edit_new_unit_comments/`,{method:"post",body:JSON.stringify({...N,token:d("vibebp").getToken()})}).then(e=>e.json()).then(e=>{if(e&&e.comment_data){if("discussions"==t){let t=[...p];t[n]=e.comment_data,v(t)}else{let t=[...u];t[n]=e.comment_data,r(t)}k({});let s=[...g];s.splice(s.indexOf(n),1),y(s)}})},T=(e,n,t)=>{if(!(h&&h.hasOwnProperty("comment_content")&&h.comment_content.length>3))return alert(window.notes_discussions.translations.enter_some_content),!1;h.comment_post_ID=e.comment_post_ID,h.comment_ID=(()=>Math.floor(1e9*Math.random()+1))(),h.unit=e.comment_post_ID;h.comment_ID;h.comment_parent=e.comment_ID,h.user_id=window.notes_discussions.user_id,h.type="reply",fetch(`${window.notes_discussions.api}/add_edit_new_unit_comments/`,{method:"post",body:JSON.stringify({...h,token:d("vibebp").getToken()})}).then(e=>e.json()).then(e=>{if(e&&e.comment_data){if("discussions"==t){let n=[...p];n.unshift(e.comment_data),v(n)}else{let n=[...u];n.unshift(e.comment_data),r(n)}b({});let s=[...f];s.splice(s.indexOf(n),1),w(s)}})},j=(e,n)=>{fetch(`${window.notes_discussions.api}/instructor_reply_comment/`,{method:"post",body:JSON.stringify({user_id:window.notes_discussions.user_id,token:d("vibebp").getToken(),unit_id:e.comment_post_ID})}).then(e=>e.json()).then(e=>{if(e.status){let e=[...m];e.push(n),_(e),alert(window.notes_discussions.translations.request_sent)}})},D=(e,n,t)=>{fetch(`${window.notes_discussions.api}/delete_comment/`,{method:"post",body:JSON.stringify({user_id:window.notes_discussions.user_id,token:d("vibebp").getToken(),comment_id:e.comment_post_ID})}).then(e=>e.json()).then(e=>{if(e.status)if("discussions"==t){let e=[...p];e.splice(n,1),v(e)}else{let e=[...u];e.splice(n,1),v(e)}})};return s("div",{className:"wplms_dashboard_notes_widget"},n?s("div",{className:"widget_loader"}," ",s("div",null),s("div",null),s("div",null),s("div",null)):s(a,null,s("div",{className:"notes_tabs"},s("div",{className:"note"==o?"active":"",onClick:()=>{l("note"),x(!0)}},window.notes_discussions.translations.my_notes),s("div",{className:"public"==o?"active":"",onClick:()=>{l("public"),x(!0)}},window.notes_discussions.translations.my_discussions)),s("div",{className:"tab_content"},s("ul",{class:"main_comments"},u.length&&"note"==o?u.map((e,n)=>s("li",{className:"note loaded"},s("div",{className:"comment_data"},s("div",{className:"user-avatar"},s("img",{src:e.avatar}),s("span",{dangerouslySetInnerHTML:{__html:e.comment_username}})),s("div",{className:"comment_meta",dangerouslySetInnerHTML:{__html:e.comment_meta}})),s("div",{className:"unit_comment_content"},-1!==g.indexOf(n)?s("div",{className:"note_content"},s(a,null,s("textarea",{value:N.comment_content,onChange:e=>{let n={...N};n.comment_content=e.target.value,k(n)}}),s("a",{className:"button",onClick:()=>{I(e,n,"notes")}},window.notes_discussions.translations.edit),s("a",{className:"button",onClick:()=>{let e=[...g];e.splice(e.indexOf(n),1),y(e)}},window.notes_discussions.translations.cancel))):s("div",{className:"note_content",dangerouslySetInnerHTML:{__html:e.comment_content}})),s("div",{className:"notes_actions"},s("div",{className:"edit_comment_c"},s("i",{class:"vicon vicon-pencil",onClick:()=>{let t={...N};t.comment_content=e.comment_content.replace(/(<([^>]+)>)/gi,""),k(t);let s=[...g];-1===s.indexOf(n)?s.push(n):s.splice(s.indexOf(n),1),y(s)}})),s("div",{className:"make_public_c",onClick:()=>{((e,n)=>{fetch(`${window.notes_discussions.api}/make_comment_public/`,{method:"post",body:JSON.stringify({user_id:window.notes_discussions.user_id,token:d("vibebp").getToken(),comment_id:e.comment_ID})}).then(e=>e.json()).then(e=>{if(e.status){let e=[...u],t=[...p];t.push(e[n]),e.splice(n,1),r(e),v(t)}})})(e,n)}},s("i",{class:"vicon vicon-user"})),s("div",{className:"reply_unit_comment_c",onClick:()=>{let e={...h};e.comment_content="",b(e);let t=[...f];-1===t.indexOf(n)?t.push(n):t.splice(t.indexOf(n),1),w(t)}},s("i",{class:"vicon vicon-share"})),s("div",{className:()=>{m.indexOf(n)},onClick:()=>{-1===m.indexOf(n)?j(e,n):alert(window.notes_discussions.translations.already_requested)}},s("i",{class:"vicon vicon-share-alt"})),s("div",{className:"remove_unit_comment_c",onClick:()=>{D(e,n,"notes")}},s("i",{class:"vicon vicon-close"}))),-1!==f.indexOf(n)?s("div",{className:"reply_wrap"},s("textarea",{value:h.comment_content,onChange:e=>{let n={...h};n.comment_content=e.target.value,b(n)}}),s("a",{className:"button",onClick:()=>{T(e,n,"notes")}},window.notes_discussions.translations.reply),s("a",{className:"button",onClick:()=>{let e={...h};e.content="",b(e);let t=[...f];t.splice(t.indexOf(n),1),w(t)}},window.notes_discussions.translations.cancel)):"")):u.length||"note"!=o?"":s("div",{className:"message"},s("p",null,window.notes_discussions.translations.no_data)),p.length&&"public"==o?p.map((e,n)=>s("li",{className:"note loaded"},s("div",{className:"comment_data"},s("div",{className:"user-avatar"},s("img",{src:e.avatar}),s("span",{dangerouslySetInnerHTML:{__html:e.comment_username}})),s("div",{className:"comment_meta",dangerouslySetInnerHTML:{__html:e.comment_meta}})),s("div",{className:"unit_comment_content"},-1!==g.indexOf(n)?s("div",{className:"note_content"},s(a,null,s("textarea",{value:N.comment_content,onChange:e=>{let n={...N};n.comment_content=e.target.value,k(n)}}),s("a",{className:"button",onClick:()=>{I(e,n,"discussions")}},window.notes_discussions.translations.edit),s("a",{className:"button",onClick:()=>{let e=[...g];e.splice(e.indexOf(n),1),y(e)}},window.notes_discussions.translations.cancel))):s("div",{className:"note_content",dangerouslySetInnerHTML:{__html:e.comment_content}})),s("div",{className:"notes_actions"},s("div",{className:"edit_comment_c"},s("i",{class:"vicon vicon-pencil",onClick:()=>{let t={...N};t.comment_content=e.comment_content.replace(/(<([^>]+)>)/gi,""),k(t);let s=[...g];-1===s.indexOf(n)?s.push(n):s.splice(s.indexOf(n),1),y(s)}})),s("div",{className:"make_public_c",onClick:()=>{((e,n)=>{fetch(`${window.notes_discussions.api}/make_comment_private/`,{method:"post",body:JSON.stringify({user_id:window.notes_discussions.user_id,token:d("vibebp").getToken(),comment_id:e.comment_ID})}).then(e=>e.json()).then(e=>{if(e.status){let e=[...u],t=[...p];e.push(t[n]),t.splice(n,1),r(e),v(t)}})})(e,n)}},s("i",{class:"vicon vicon-user"})),s("div",{className:"reply_unit_comment_c",onClick:()=>{let e={...h};e.comment_content="",b(e);let t=[...f];-1===t.indexOf(n)?t.push(n):t.splice(t.indexOf(n),1),w(t)}},s("i",{class:"vicon vicon-share"})),s("div",{className:()=>{m.indexOf(n)},onClick:()=>{-1===m.indexOf(n)?j(e,n):alert(window.notes_discussions.translations.already_requested)}},s("i",{class:"vicon vicon-share-alt"})),s("div",{className:"remove_unit_comment_c",onClick:()=>{D(e,n,"discussions")}},s("i",{class:"vicon vicon-close"}))),-1!==f.indexOf(n)?s("div",{className:"reply_wrap"},s("textarea",{value:h.comment_content,onChange:e=>{let n={...h};n.comment_content=e.target.value,b(n)}}),s("a",{className:"button",onClick:()=>{T(e,n,"discussions")}},window.notes_discussions.translations.reply),s("a",{className:"button",onClick:()=>{let e={...h};e.content="",b(e);let t=[...f];t.splice(t.indexOf(n),1),w(t)}},window.notes_discussions.translations.cancel)):"")):p.length||"discussions"!=o?"":s("div",{className:"message"},s("p",null,window.notes_discussions.translations.no_data))),O?s("div",{className:"button",onClick:()=>{(()=>{let n=C;n++,fetch(`${window.notes_discussions.api}/get_notes/`,{method:"post",body:JSON.stringify({user_id:window.notes_discussions.user_id,token:d("vibebp").getToken(),number:e.settings.number,type:o,page:n})}).then(e=>e.json()).then(e=>{if(e.status)if(e.data.length){if("public"==o){let n=[...p];e.data.map(e=>{n.push(e)}),v(n)}else{let n=[...u];e.data.map(e=>{n.push(e)}),r(n)}S(n)}else x(!1);else x(!1);t(!1)})})()}},window.notes_discussions.translations.load_more):"")))};document.addEventListener("wplms_notes_discussion",e=>{console.log("details event",e),document.querySelectorAll(".wplms_dashboard_notes_discussions").forEach(n=>{o(s(_,{type:n.getAttribute("data-type"),settings:e.detail.widget.options}),n)})})},function(e,n,t){}]);